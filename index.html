<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ELAN Server - Arma Reforger Crafting System</title>
  <style>
    :root {
      --bg-dark: #18181b;
      --bg-darker: #121214;
      --bg-medium: #27272a;
      --bg-light: #3f3f46;
      --border-color: #52525b;
      --text-light: #f4f4f5;
      --text-medium: #d4d4d8;
      --text-dim: #a1a1aa;
      --iron-color: #4682B4;
      --copper-color: #E9967A;
      --gold-color: #DAA520;
      --silver-color: #C0C0C0;
      --charcoal-color: #FF7F50;
      --fabric-color: #9370DB;
      --polyester-color: #20B2AA;
      --wooden-color: #8B4513;
      --petrol-color: #32CD32;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }

    body {
      background-color: var(--bg-dark);
      color: var(--text-light);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      background-color: var(--bg-medium);
      border-bottom: 1px solid var(--border-color);
      padding: 1rem;
    }

    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    @media (min-width: 768px) {
      .header-content {
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
      }
    }

    h1 {
      font-size: 1.5rem;
      font-weight: bold;
    }

    .search-container {
      position: relative;
      width: 100%;
    }

    @media (min-width: 768px) {
      .search-container {
        width: 250px;
      }
    }

    .search-icon {
      position: absolute;
      left: 0.5rem;
      top: 50%;
      transform: translateY(-50%);
      width: 1rem;
      height: 1rem;
      color: var(--text-dim);
    }

    input[type="text"] {
      width: 100%;
      padding: 0.5rem 0.5rem 0.5rem 2rem;
      background-color: var(--bg-light);
      border: 1px solid var(--border-color);
      border-radius: 0.25rem;
      color: var(--text-light);
    }

    input[type="text"]::placeholder {
      color: var(--text-dim);
    }

    input[type="text"]:focus {
      outline: none;
      border-color: var(--text-dim);
    }

    .main-container {
      display: flex;
      flex: 1;
      overflow: hidden;
    }

    aside {
      width: 250px;
      background-color: var(--bg-medium);
      border-right: 1px solid var(--border-color);
      overflow-y: auto;
      display: none;
    }

    @media (min-width: 768px) {
      aside {
        display: block;
      }
    }

    .sidebar-content {
      padding: 1rem;
    }

    h2 {
      font-size: 1.25rem;
      font-weight: bold;
      margin-bottom: 1rem;
    }

    .category-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .category-button, .subcategory-button, .item-button {
      display: flex;
      align-items: center;
      width: 100%;
      text-align: left;
      padding: 0.5rem;
      border: none;
      background: none;
      color: var(--text-light);
      cursor: pointer;
      border-radius: 0.25rem;
    }

    .category-button:hover, .subcategory-button:hover {
      background-color: var(--bg-light);
    }

    .subcategory-list {
      margin-left: 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
      margin-top: 0.25rem;
    }

    .subcategory-button {
      font-size: 0.875rem;
    }

    .item-list {
      margin-left: 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
      margin-top: 0.25rem;
    }

    .item-button {
      font-size: 0.875rem;
    }

    .item-button.active {
      background-color: var(--bg-light);
    }

    .item-button:hover {
      background-color: var(--bg-light);
    }

    main {
      flex: 1;
      padding: 1rem;
      overflow-y: auto;
    }

    .search-results {
      margin-bottom: 1.5rem;
    }

    .search-results-title {
      font-size: 1.25rem;
      font-weight: bold;
      margin-bottom: 1rem;
    }

    .search-results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1rem;
    }

    .search-result-item {
      padding: 1rem;
      background-color: var(--bg-medium);
      border: 1px solid var(--border-color);
      border-radius: 0.25rem;
      cursor: pointer;
    }

    .search-result-item:hover {
      background-color: var(--bg-light);
    }

    .search-result-title {
      font-weight: bold;
      margin-bottom: 0.25rem;
    }

    .search-result-path {
      font-size: 0.875rem;
      color: var(--text-dim);
    }

    .item-header {
      display: flex;
      align-items: center;
      margin-bottom: 1rem;
    }

    .item-title {
      font-size: 1.25rem;
      font-weight: bold;
    }

    .item-path {
      font-size: 0.875rem;
      color: var(--text-dim);
      margin-left: 0.5rem;
    }

    .item-path-link {
      color: var(--text-medium);
      text-decoration: none;
      cursor: pointer;
    }

    .item-path-link:hover {
      text-decoration: underline;
    }

    .crafting-table {
      background-color: var(--bg-medium);
      border: 1px solid var(--border-color);
      border-radius: 0.25rem;
      overflow: hidden;
    }

    .crafting-table-header {
      padding: 1rem;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .crafting-table-title {
      font-weight: bold;
    }

    .crafting-table-quantity {
      font-size: 0.875rem;
      color: var(--text-dim);
    }

    .crafting-table-content {
      padding: 1rem;
    }

    .crafting-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }

    @media (min-width: 1024px) {
      .crafting-grid {
        grid-template-columns: 3fr 1fr;
      }
    }

    .section-title {
      font-weight: 600;
      margin-bottom: 0.75rem;
    }

    .table-container {
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th {
      background-color: var(--bg-light);
      text-align: left;
      padding: 0.5rem;
      white-space: nowrap;
    }

    td {
      padding: 0.5rem;
      background-color: var(--bg-light);
      border-top: 1px solid var(--border-color);
    }

    .text-center {
      text-align: center;
    }

    .preview-container {
      background-color: var(--bg-darker);
      padding: 1rem;
      border-radius: 0.25rem;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .preview-image {
      max-width: 100%;
      max-height: 150px;
      object-fit: contain;
    }

    .iron-color { color: var(--iron-color); }
    .copper-color { color: var(--copper-color); }
    .gold-color { color: var(--gold-color); }
    .silver-color { color: var(--silver-color); }
    .charcoal-color { color: var(--charcoal-color); }
    .fabric-color { color: var(--fabric-color); }
    .polyester-color { color: var(--polyester-color); }
    .wooden-color { color: var(--wooden-color); }
    .petrol-color { color: var(--petrol-color); }

    .hidden {
      display: none !important;
    }

    .chevron-icon {
      width: 16px;
      height: 16px;
      margin-right: 0.25rem;
    }

    .subcategory-button .chevron-icon {
      width: 14px;
      height: 14px;
    }

    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100%;
      font-size: 1.25rem;
      color: var(--text-dim);
    }

    .loading-spinner {
      border: 4px solid var(--bg-light);
      border-top: 4px solid var(--text-light);
      border-radius: 50%;
      width: 24px;
      height: 24px;
      animation: spin 1s linear infinite;
      margin-right: 0.5rem;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .welcome-message {
      text-align: center;
      padding: 2rem;
      background-color: var(--bg-medium);
      border-radius: 0.5rem;
      border: 1px solid var(--border-color);
    }

    .welcome-message h2 {
      margin-bottom: 1rem;
    }

    .welcome-message p {
      margin-bottom: 0.5rem;
      color: var(--text-medium);
    }

    .components-table th, .components-table td {
      border-right: 1px solid var(--border-color);
    }

    .components-table th:last-child, .components-table td:last-child {
      border-right: none;
    }

    .separator-row {
      height: 10px;
      background-color: var(--bg-medium);
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="header-content">
      <h1>ELAN Server - Arma Reforger Crafting System</h1>
      <div class="search-container">
        <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
        <input type="text" id="search-input" placeholder="Search for items...">
      </div>
    </div>
  </header>

  <div class="main-container">
    <!-- Sidebar -->
    <aside>
      <div class="sidebar-content">
        <h2>Categories</h2>
        <div class="category-list" id="category-list">
          <div class="loading">
            <div class="loading-spinner"></div>
            Loading...
          </div>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main>
      <div id="loading-indicator" class="loading">
        <div class="loading-spinner"></div>
        Loading crafting data...
      </div>

      <div id="search-results" class="search-results hidden">
        <h2 class="search-results-title">Search results for "<span id="search-query"></span>"</h2>
        <div id="search-results-grid" class="search-results-grid">
          <!-- Search results will be populated by JavaScript -->
        </div>
      </div>

      <div id="category-results" class="search-results hidden">
        <h2 class="search-results-title">Items in "<span id="category-name"></span>"</h2>
        <div id="category-results-grid" class="search-results-grid">
          <!-- Category results will be populated by JavaScript -->
        </div>
      </div>

      <div id="welcome-screen" class="hidden">
        <div class="welcome-message">
          <h2>Welcome to Arma Reforger Crafting System</h2>
          <p>Select an item from the sidebar to view crafting details.</p>
          <p>You can also search for items using the search bar above.</p>
        </div>
      </div>

      <div id="item-display" class="hidden">
        <div class="item-header">
          <h2 class="item-title" id="current-item-title"></h2>
          <span class="item-path" id="current-item-path"></span>
        </div>
        <div class="crafting-table">
          <div class="crafting-table-header">
            <span class="crafting-table-title" id="crafting-title"></span>
            <span class="crafting-table-quantity">Quantity: <span id="crafting-quantity"></span></span>
          </div>
          <div class="crafting-table-content">
            <div class="crafting-grid">
              <div>
                <h3 class="section-title">Required Components</h3>
                <div class="table-container">
                  <table class="components-table">
                    <thead>
                      <tr>
                        <th>Item</th>
                        <th class="text-center">Quantity</th>
                        <th>Material</th>
                        <th class="text-center">Quantity</th>
                        <th>Material</th>
                        <th class="text-center">Quantity</th>
                      </tr>
                    </thead>
                    <tbody id="components-table">
                      <!-- Components will be populated by JavaScript -->
                    </tbody>
                  </table>
                </div>
                
                <h3 class="section-title" style="margin-top: 1.5rem;">Total Materials</h3>
                <div class="table-container">
                  <table>
                    <thead>
                      <tr>
                        <th>Material</th>
                        <th class="text-center">Quantity</th>
                      </tr>
                    </thead>
                    <tbody id="materials-table">
                      <!-- Materials will be populated by JavaScript -->
                    </tbody>
                  </table>
                </div>
              </div>
              
              <div>
                <h3 class="section-title">Preview</h3>
                <div class="preview-container">
                  <img id="item-image" src="https://hebbkx1anhila5yf.public.blob.vercel-storage.com/image-viUmtxHHOsQ5YWsrZWjZ1uheFjmlPT.png" alt="Item preview" class="preview-image">
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
    // Material colors
    const COLORS = {
      "Iron ingot": "#4682B4",
      "Copper ingot": "#E9967A",
      "Gold ingot": "#DAA520",
      "Silver ingot": "#C0C0C0",
      "Charcoal": "#FF7F50",
      "Fabric": "#9370DB",
      "Polyester": "#20B2AA",
      "Wooden planks": "#8B4513",
      "Canister (petrol)": "#32CD32"
    };

    // State
    let craftingData = {};
    let expandedCategories = {};
    let expandedSubcategories = {};
    let selectedItem = null;
    let searchQuery = "";
    let dataLoaded = false;
    let categoryView = null;

    // DOM elements
    const loadingIndicatorEl = document.getElementById('loading-indicator');
    const categoryListEl = document.getElementById('category-list');
    const searchInputEl = document.getElementById('search-input');
    const searchResultsEl = document.getElementById('search-results');
    const searchQueryEl = document.getElementById('search-query');
    const searchResultsGridEl = document.getElementById('search-results-grid');
    const categoryResultsEl = document.getElementById('category-results');
    const categoryNameEl = document.getElementById('category-name');
    const categoryResultsGridEl = document.getElementById('category-results-grid');
    const welcomeScreenEl = document.getElementById('welcome-screen');
    const itemDisplayEl = document.getElementById('item-display');
    const currentItemTitleEl = document.getElementById('current-item-title');
    const currentItemPathEl = document.getElementById('current-item-path');
    const craftingTitleEl = document.getElementById('crafting-title');
    const craftingQuantityEl = document.getElementById('crafting-quantity');
    const componentsTableEl = document.getElementById('components-table');
    const materialsTableEl = document.getElementById('materials-table');
    const itemImageEl = document.getElementById('item-image');

    // Load crafting data from JSON file
    async function loadCraftingData() {
      try {
        const response = await fetch('crafting-data.json');
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        craftingData = await response.json();
        
        // Initialize expanded categories
        Object.keys(craftingData).forEach(category => {
          expandedCategories[category] = false;
          
          Object.keys(craftingData[category].subcategories).forEach(subcategory => {
            expandedSubcategories[`${category}-${subcategory}`] = false;
          });
        });
        
        dataLoaded = true;
        loadingIndicatorEl.classList.add('hidden');
        welcomeScreenEl.classList.remove('hidden');
        
        // Initialize UI
        updateUI();
      } catch (error) {
        console.error('Error loading crafting data:', error);
        loadingIndicatorEl.innerHTML = `
          <div>
            <p>Error loading crafting data. Please check if the JSON file exists and is valid.</p>
            <p style="color: red; margin-top: 0.5rem;">${error.message}</p>
            <p style="margin-top: 1rem;">Note: To load external JSON files, you need to run this page on a web server.</p>
            <p>You can use a simple local server like:</p>
            <ul style="margin-top: 0.5rem; margin-left: 1.5rem;">
              <li>Python: <code>python -m http.server</code></li>
              <li>Node.js: <code>npx serve</code></li>
              <li>VS Code Live Server extension</li>
            </ul>
          </div>
        `;
      }
    }

    // Get all items for search
    function getAllItems() {
      const allItems = [];
      
      Object.entries(craftingData).forEach(([categoryKey, category]) => {
        Object.entries(category.subcategories).forEach(([subcategoryKey, subcategory]) => {
          subcategory.items.forEach(item => {
            allItems.push({
              ...item,
              categoryKey,
              subcategoryKey,
              category: category.name,
              subcategory: subcategory.name,
            });
          });
        });
      });
      
      return allItems;
    }

    // Initialize the sidebar
    function initializeSidebar() {
      categoryListEl.innerHTML = '';
      
      Object.entries(craftingData).forEach(([categoryKey, category]) => {
        const categoryEl = document.createElement('div');
        categoryEl.innerHTML = `
          <button class="category-button" data-category="${categoryKey}">
            <svg class="chevron-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              ${expandedCategories[categoryKey] ? 
                '<polyline points="6 9 12 15 18 9"></polyline>' : 
                '<polyline points="9 18 15 12 9 6"></polyline>'}
            </svg>
            ${category.name}
          </button>
        `;
        
        if (expandedCategories[categoryKey]) {
          const subcategoriesEl = document.createElement('div');
          subcategoriesEl.className = 'subcategory-list';
          
          Object.entries(category.subcategories).forEach(([subcategoryKey, subcategory]) => {
            const subcategoryEl = document.createElement('div');
            const subcategoryId = `${categoryKey}-${subcategoryKey}`;
            
            subcategoryEl.innerHTML = `
              <button class="subcategory-button" data-category="${categoryKey}" data-subcategory="${subcategoryKey}">
                <svg class="chevron-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  ${expandedSubcategories[subcategoryId] ? 
                    '<polyline points="6 9 12 15 18 9"></polyline>' : 
                    '<polyline points="9 18 15 12 9 6"></polyline>'}
                </svg>
                ${subcategory.name}
              </button>
            `;
            
            if (expandedSubcategories[subcategoryId]) {
              const itemsEl = document.createElement('div');
              itemsEl.className = 'item-list';
              
              subcategory.items.forEach(item => {
                const itemEl = document.createElement('button');
                itemEl.className = `item-button ${selectedItem === item.id ? 'active' : ''}`;
                itemEl.setAttribute('data-item-id', item.id);
                itemEl.textContent = item.title;
                
                itemEl.addEventListener('click', () => {
                  selectItem(item.id);
                });
                
                itemsEl.appendChild(itemEl);
              });
              
              subcategoryEl.appendChild(itemsEl);
            }
            
            subcategoriesEl.appendChild(subcategoryEl);
          });
          
          categoryEl.appendChild(subcategoriesEl);
        }
        
        categoryListEl.appendChild(categoryEl);
      });
      
      // Add event listeners to category buttons
      document.querySelectorAll('.category-button').forEach(button => {
        button.addEventListener('click', () => {
          const category = button.getAttribute('data-category');
          toggleCategory(category);
        });
      });
      
      // Add event listeners to subcategory buttons
      document.querySelectorAll('.subcategory-button').forEach(button => {
        button.addEventListener('click', () => {
          const category = button.getAttribute('data-category');
          const subcategory = button.getAttribute('data-subcategory');
          toggleSubcategory(category, subcategory);
        });
      });
    }

    // Toggle category expansion
    function toggleCategory(category) {
      expandedCategories[category] = !expandedCategories[category];
      initializeSidebar();
    }

    // Toggle subcategory expansion
    function toggleSubcategory(category, subcategory) {
      const key = `${category}-${subcategory}`;
      expandedSubcategories[key] = !expandedSubcategories[key];
      initializeSidebar();
    }

    // Select an item
    function selectItem(itemId) {
      selectedItem = itemId;
      searchQuery = '';
      searchInputEl.value = '';
      categoryView = null;
      updateUI();
    }

    // Handle search
    function handleSearch() {
      searchQuery = searchInputEl.value.trim();
      categoryView = null;
      updateUI();
    }

    // Show category items
    function showCategoryItems(categoryName) {
      categoryView = categoryName;
      updateUI();
    }

    // Update the UI based on current state
    function updateUI() {
      if (!dataLoaded) return;
      
      // Update sidebar
      initializeSidebar();
      
      // Hide all main content sections initially
      searchResultsEl.classList.add('hidden');
      categoryResultsEl.classList.add('hidden');
      welcomeScreenEl.classList.add('hidden');
      itemDisplayEl.classList.add('hidden');
      
      // Handle search results
      if (searchQuery) {
        const allItems = getAllItems();
        const filteredItems = allItems.filter(item => 
          item.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
          item.category.toLowerCase().includes(searchQuery.toLowerCase()) ||
          item.subcategory.toLowerCase().includes(searchQuery.toLowerCase())
        );
        
        searchQueryEl.textContent = searchQuery;
        searchResultsGridEl.innerHTML = '';
        
        if (filteredItems.length > 0) {
          filteredItems.forEach(item => {
            const itemEl = document.createElement('div');
            itemEl.className = 'search-result-item';
            itemEl.innerHTML = `
              <div class="search-result-title">${item.title}</div>
              <div class="search-result-path">${item.category} > ${item.subcategory}</div>
            `;
            
            itemEl.addEventListener('click', () => {
              selectItem(item.id);
            });
            
            searchResultsGridEl.appendChild(itemEl);
          });
        } else {
          searchResultsGridEl.innerHTML = '<p>No results found.</p>';
        }
        
        searchResultsEl.classList.remove('hidden');
      } 
      // Handle category view
      else if (categoryView) {
        const allItems = getAllItems();
        const filteredItems = allItems.filter(item => 
          item.category === categoryView || item.subcategory === categoryView
        );
        
        categoryNameEl.textContent = categoryView;
        categoryResultsGridEl.innerHTML = '';
        
        if (filteredItems.length > 0) {
          filteredItems.forEach(item => {
            const itemEl = document.createElement('div');
            itemEl.className = 'search-result-item';
            itemEl.innerHTML = `
              <div class="search-result-title">${item.title}</div>
              <div class="search-result-path">${item.category} > ${item.subcategory}</div>
            `;
            
            itemEl.addEventListener('click', () => {
              selectItem(item.id);
            });
            
            categoryResultsGridEl.appendChild(itemEl);
          });
        } else {
          categoryResultsGridEl.innerHTML = '<p>No items found in this category.</p>';
        }
        
        categoryResultsEl.classList.remove('hidden');
      }
      // Show item display if an item is selected, otherwise show welcome screen
      else if (selectedItem) {
        // Find the current item
        const allItems = getAllItems();
        const currentItem = allItems.find(item => item.id === selectedItem);
        
        if (currentItem) {
          // Update item display
          currentItemTitleEl.textContent = currentItem.title;
          
          // Create clickable path
          const pathHTML = `
            <span class="item-path-link" data-category="${currentItem.category}">${currentItem.category}</span> > 
            <span class="item-path-link" data-category="${currentItem.subcategory}">${currentItem.subcategory}</span>
          `;
          currentItemPathEl.innerHTML = pathHTML;
          
          // Add event listeners to path links
          document.querySelectorAll('.item-path-link').forEach(link => {
            link.addEventListener('click', () => {
              const category = link.getAttribute('data-category');
              showCategoryItems(category);
            });
          });
          
          craftingTitleEl.textContent = currentItem.title;
          craftingQuantityEl.textContent = currentItem.quantity;
          itemImageEl.src = currentItem.imageUrl;
          itemImageEl.alt = currentItem.title;
          
          // Update components table
          componentsTableEl.innerHTML = '';

          // Check if any item has base materials
          let hasBaseMaterials = false;
          currentItem.items.forEach(item => {
            const hasSubMaterials = item.subMaterials && Object.keys(item.subMaterials).length > 0;
            if (hasSubMaterials) {
              hasBaseMaterials = true;
            }
          });

          // Update table headers based on whether base materials exist
          const tableHeaders = document.querySelector('.components-table thead tr');
          tableHeaders.innerHTML = `
            <th>Item</th>
            <th class="text-center">Quantity</th>
            <th>Material</th>
            <th class="text-center">Quantity</th>
            ${hasBaseMaterials ? '<th>Material</th><th class="text-center">Quantity</th>' : ''}
          `;

          // Process each component
          for (let itemIndex = 0; itemIndex < currentItem.items.length; itemIndex++) {
            const item = currentItem.items[itemIndex];
            
            // Check if this item has submaterials
            const hasSubMaterials = item.subMaterials && Object.keys(item.subMaterials).length > 0;
            
            // Create the first row with the primary component
            const firstRow = document.createElement('tr');
            
            // First two columns are always the component name and quantity
            let firstRowHTML = `
              <td>${item.name}</td>
              <td class="text-center">${item.quantity}</td>
            `;
            
            // Add the first material
            if (item.materials.length > 0) {
              firstRowHTML += `
                <td class="${getMaterialColorClass(item.materials[0].name)}">${item.materials[0].name}</td>
                <td class="text-center">${item.materials[0].quantity}</td>
              `;
              
              // Check if this material has submaterials
              if (hasSubMaterials && item.subMaterials[item.materials[0].name] && item.subMaterials[item.materials[0].name].length > 0) {
                if (hasBaseMaterials) {
                  firstRowHTML += `
                    <td class="${getMaterialColorClass(item.subMaterials[item.materials[0].name][0].name)}">${item.subMaterials[item.materials[0].name][0].name}</td>
                    <td class="text-center">${item.subMaterials[item.materials[0].name][0].quantity}</td>
                  `;
                }
              } else if (hasBaseMaterials) {
                firstRowHTML += `
                  <td></td>
                  <td></td>
                `;
              }
            } else {
              firstRowHTML += `
                <td></td>
                <td></td>
              `;
              if (hasBaseMaterials) {
                firstRowHTML += `
                  <td></td>
                  <td></td>
                `;
              }
            }
            
            firstRow.innerHTML = firstRowHTML;
            componentsTableEl.appendChild(firstRow);
            
            // Add rows for additional submaterials of the first material
            if (hasSubMaterials && item.materials.length > 0 && item.subMaterials[item.materials[0].name] && item.subMaterials[item.materials[0].name].length > 1) {
              for (let i = 1; i < item.subMaterials[item.materials[0].name].length; i++) {
                const subMaterial = item.subMaterials[item.materials[0].name][i];
                const subRow = document.createElement('tr');
                let subRowHTML = `
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                `;
                
                if (hasBaseMaterials) {
                  subRowHTML += `
                    <td class="${getMaterialColorClass(subMaterial.name)}">${subMaterial.name}</td>
                    <td class="text-center">${subMaterial.quantity}</td>
                  `;
                }
                
                subRow.innerHTML = subRowHTML;
                componentsTableEl.appendChild(subRow);
              }
            }
            
            // Add rows for additional materials
            for (let i = 1; i < item.materials.length; i++) {
              const material = item.materials[i];
              const materialRow = document.createElement('tr');
              
              let materialRowHTML = `
                <td></td>
                <td></td>
                <td class="${getMaterialColorClass(material.name)}">${material.name}</td>
                <td class="text-center">${material.quantity}</td>
              `;
              
              // Check if this material has submaterials
              if (hasSubMaterials && item.subMaterials[material.name] && item.subMaterials[material.name].length > 0) {
                if (hasBaseMaterials) {
                  materialRowHTML += `
                    <td class="${getMaterialColorClass(item.subMaterials[material.name][0].name)}">${item.subMaterials[material.name][0].name}</td>
                    <td class="text-center">${item.subMaterials[material.name][0].quantity}</td>
                  `;
                }
                
                materialRow.innerHTML = materialRowHTML;
                componentsTableEl.appendChild(materialRow);
                
                // Add rows for additional submaterials
                for (let j = 1; j < item.subMaterials[material.name].length; j++) {
                  const subMaterial = item.subMaterials[material.name][j];
                  const subRow = document.createElement('tr');
                  let subRowHTML = `
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                  `;
                  
                  if (hasBaseMaterials) {
                    subRowHTML += `
                      <td class="${getMaterialColorClass(subMaterial.name)}">${subMaterial.name}</td>
                      <td class="text-center">${subMaterial.quantity}</td>
                    `;
                  }
                  
                  subRow.innerHTML = subRowHTML;
                  componentsTableEl.appendChild(subRow);
                }
              } else {
                if (hasBaseMaterials) {
                  materialRowHTML += `
                    <td></td>
                    <td></td>
                  `;
                }
                
                materialRow.innerHTML = materialRowHTML;
                componentsTableEl.appendChild(materialRow);
              }
            }
            
            // Add a separator row if this is not the last item
            if (itemIndex < currentItem.items.length - 1) {
              const separatorRow = document.createElement('tr');
              let separatorHTML = `<td colspan="${hasBaseMaterials ? 6 : 4}" style="height: 10px; background-color: var(--bg-medium);"></td>`;
              separatorRow.innerHTML = separatorHTML;
              componentsTableEl.appendChild(separatorRow);
            }
          }
          
          // Update materials table
          materialsTableEl.innerHTML = '';
          currentItem.totalMaterials.forEach(material => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td class="${getMaterialColorClass(material.name)}">${material.name}</td>
              <td class="text-center">${material.quantity}</td>
            `;
            materialsTableEl.appendChild(row);
          });
          
          itemDisplayEl.classList.remove('hidden');
        }
      } else {
        welcomeScreenEl.classList.remove('hidden');
      }
    }

    // Get material color class
    function getMaterialColorClass(materialName) {
      switch (materialName) {
        case 'Iron ingot': return 'iron-color';
        case 'Copper ingot': return 'copper-color';
        case 'Gold ingot': return 'gold-color';
        case 'Silver ingot': return 'silver-color';
        case 'Charcoal': return 'charcoal-color';
        case 'Fabric': return 'fabric-color';
        case 'Polyester': return 'polyester-color';
        case 'Wooden planks': return 'wooden-color';
        case 'Canister (petrol)': return 'petrol-color';
        default: return '';
      }
    }

    // Event listeners
    searchInputEl.addEventListener('input', handleSearch);

    // Load data and initialize the UI
    loadCraftingData();
  </script>
</body>
</html>
